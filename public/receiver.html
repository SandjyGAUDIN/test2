<!doctype html>
<html>
<head><meta charset="utf-8"><title>Receiver</title></head>
<body>
<h2>Receiver</h2>
<label>Room: <input id="room" value="myroom"></label>
<label>Password: <input id="password" value="1234"></label>
<button id="join">Join</button>
<button id="refreshFiles">Refresh files</button>
<video id="remote" autoplay playsinline controls></video>
<ul id="fileList"></ul>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();let pc;
const room=()=>document.getElementById('room').value;
const pass=()=>document.getElementById('password').value;
document.getElementById('join').onclick=async()=>{const ack=await new Promise(r=>socket.emit('join-room',{room:room(),password:pass(),role:'receiver'},r));if(!ack.ok)return alert(ack.err);pc=new RTCPeerConnection();pc.ontrack=e=>document.getElementById('remote').srcObject=e.streams[0];pc.onicecandidate=e=>{if(e.candidate)socket.emit('ice-candidate',e.candidate);};socket.on('offer',async o=>{await pc.setRemoteDescription(o);const ans=await pc.createAnswer();await pc.setLocalDescription(ans);socket.emit('answer',ans);});socket.on('ice-candidate',async c=>{try{await pc.addIceCandidate(c);}catch(e){}});};
async function refresh(){const r=await fetch(`/files?room=${room()}`);const f=await r.json();const ul=document.getElementById('fileList');ul.innerHTML='';f.forEach(n=>{const li=document.createElement('li');const a=document.createElement('a');a.href='/uploads/'+n;a.textContent=n;a.target='_blank';li.appendChild(a);ul.appendChild(li);});}
document.getElementById('refreshFiles').onclick=refresh;
socket.on('new-file',()=>refresh());
</script>
</body></html>
